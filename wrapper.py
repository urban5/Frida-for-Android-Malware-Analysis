### This script assists in attaching a Frida script to applications that encounters the "Failed to spawn: unable to find front-door activity" error. 
### Script is continuously checking for the application to be manually opened by the user (via app drawer or adb). Once the app is detected as running, Frida script is attached.
### SHA256 of application script has been tested on: 24b7120b09b6510502224732bab274f0cfc3e54a619c76a07cc9d77fc29853ff.

### Usage: python3 wrapper.py  wocwvy.czyxoxmbauu.slsa twitter_chinese_chars_a_hook2.js

import frida
import sys
import codecs
import os
import time

def callback(message, data):
    if 'payload' in message and message['type'] == 'send':
        print("[!] callback -> {0}".format(message['payload']))
    else:
        print(message)

def get_pid_for_package(device, package_name):
    while True:
        try:
            frontmost_application = device.get_frontmost_application()
            if frontmost_application:
                return frontmost_application.pid
            else:
                print("[*] No frontmost application found. Waiting...")
                time.sleep(0.1)
        except frida.ServerNotRunningError:
            print("[!] Frida server is not running. Please start it.")
            time.sleep(0.3)
        except Exception as e:
            print("[!] An error occurred:", e)
            time.sleep(0.3)

def main():
    if len(sys.argv) < 3:
        print("wrapper.py <appname> <agent>")
        sys.exit(0)

    package_name = sys.argv[1]
    source = None
    with codecs.open(sys.argv[2], "r", "utf-8") as f:
        source = f.read()

    if source:
        device = frida.get_usb_device()

        print("[*] Waiting for the application to be opened...")
        time.sleep(1.5)  # Add a 1-second sleep
        pid = get_pid_for_package(device, package_name)

        print("[*] Found process with PID:", pid)

        session = device.attach(pid)
        time.sleep(0.5)
        script = session.create_script(source)
        script.on('message', callback)
        script.load()

        input("Press Enter to exit...\n")

    else:
        print("failed to read the frida agent")
        sys.exit(1)

if __name__ == '__main__':
    main()
